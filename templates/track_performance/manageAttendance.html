{% extends 'common\baseView.html' %}
{% load staticfiles %}

{% block pageCSS %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/track_performance/dataTables.bootstrap5.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/track_performance/responsive.bootstrap5.min.css' %}">

{% endblock %}

{% block viewName %}
    <h2 class="content-header-title float-start mb-0">Manage Employees Attendance</h2>
{% endblock %}


{% block content %}
    <div class="card">
        <div class="card-header border-bottom">
            <div class="col-md-8">
                <h4 class="card-title">Attendance Records</h4>
                {% if file_upload_error%}
                    {{file_upload_error}}
                {% endif %}
            </div>
            <div class="col-md-4">
                <button style="width: 250px" type="submit" class="btn btn-outline-success round waves-effect" data-bs-toggle="modal" data-bs-target="#UploadModal">Upload Attendance Sheet</button>
            </div>
        </div>
        <div class="card-body">
            <div class="alert alert-secondary" role="alert">
                <div class="alert-body">
                    <strong>Info:</strong> You can filter the table results by searching about specific name or sepcific date.
                </div>
            </div>
            <form class="dt_adv_search" method="POST">
                <div class="row g-1 mb-md-1">
                    <div class="col-md-4">
                        <label class="form-label">Name:</label>
                        <input type="text" class="form-control dt-input dt-full-name" data-column="1" placeholder="Alaric Beslier" data-column-index="0" />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Date:</label>
                        <div class="mb-0">
                            <input type="text" class="form-control dt-date flatpickr-range dt-input" data-column="5" placeholder="StartDate to EndDate" data-column-index="4" name="dt_date" />
                            <input type="hidden" class="form-control dt-date start_date dt-input" data-column="5" data-column-index="4" name="value_from_start_date" />
                            <input type="hidden" class="form-control dt-date end_date dt-input" name="value_from_end_date" data-column="5" data-column-index="4" />
                        </div>
                    </div>
                </div>
            </form>

            <div class="card-datatable">
                <table class="dt-advanced-search table">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Date</th>
                        <th>Clock-in</th>
                        <th>Clock-out</th>
                        <th>Total hours</th>
                    </tr>
                    <!-- <tr>
                        <td>#</td>
                        <td>Name</td>
                        <td>Date</td>
                        <td>Clock-in</td>
                        <td>Clock-out</td>
                        <td>Total hours</td>
                    </tr> -->
                    </thead>

                </table>
            </div>
        </div>
    </div>

    <div class="modal fade text-start" id="UploadModal" tabindex="-1" aria-labelledby="myModalLabel33" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalLabel33">Upload New Record</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="" method="post" enctype="multipart/form-data">
                        {%csrf_token%}
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="formFile" class="form-label">Choose Excel File</label>
                                    <input class="form-control" name="attendance_file" type="file" id="Att_File">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label" for="att_date">Date</label>
                                    <input type="text" id="att_date" name="attendance_file_date" class="form-control flatpickr-basic flatpickr-input" placeholder="YYYY-MM-DD" readonly="readonly">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" data-bs-dismiss="modal">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    <!-- END: Page JS-->
{% endblock %}

{% block pageCJs %}
    <script src="{% static 'js/track_performance/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'js/track_performance/dataTables.bootstrap5.min.js' %}"></script>
    <script src="{% static 'js/track_performance/dataTables.responsive.min.js' %}"></script>
    <script src="{% static 'js/track_performance/responsive.bootstrap5.js' %}"></script>
    <script src="{% static 'js/track_performance/table-datatables-advanced.min.js' %}"></script>
{#    <script src="{% static 'js/track_performance/table-datatables-advanced.js' %}"></script>#}

    <script>
        $(function (){
            // Advanced Search
            // --------------------------------------------------------------------
               dt_adv_filter_table = $('.dt-advanced-search');

            // Advanced Filter table
            if (dt_adv_filter_table.length) {
                var dt_adv_filter = dt_adv_filter_table.DataTable({
                    ajax: assetPath + 'data/table-datatable.json',
                    columns: [
                        { data: 'attendance_id' },//here you write the column name of the DB that match the first column in DataTable.
                        { data: '' },
                        { data: '' },
                        { data: '' },
                        { data: '' },
                        { data: '' }

                    ],

                    columnDefs: [
                        {
                            className: 'control',
                            orderable: false,
                            targets: 0
                        }
                    ],
                    dom: '<"d-flex justify-content-between align-items-center mx-0 row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>t<"d-flex justify-content-between mx-0 row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',
                    orderCellsTop: true,
                    responsive: {
                        details: {
                            display: $.fn.dataTable.Responsive.display.modal({
                                header: function (row) {
                                    var data = row.data();
                                    return 'Details of ' + data['full_name'];
                                }
                            }),
                            type: 'column',
                            renderer: function (api, rowIdx, columns) {
                                var data = $.map(columns, function (col, i) {
                                    return col.title !== '' // ? Do not show row in modal popup if title is blank (for check box)
                                        ? '<tr data-dt-row="' +
                                        col.rowIndex +
                                        '" data-dt-column="' +
                                        col.columnIndex +
                                        '">' +
                                        '<td>' +
                                        col.title +
                                        ':' +
                                        '</td> ' +
                                        '<td>' +
                                        col.data +
                                        '</td>' +
                                        '</tr>'
                                        : '';
                                }).join('');

                                return data ? $('<table class="table"/><tbody />').append(data) : false;
                            }
                        }
                    },
                    language: {
                        paginate: {
                            // remove previous & next text from pagination
                            previous: '&nbsp;',
                            next: '&nbsp;'
                        }
                    }
                });
            }

            // on key up from input field
            $('input.dt-input').on('keyup', function () {
                filterColumn($(this).attr('data-column'), $(this).val());
            });
        })
    </script>

{% endblock %}